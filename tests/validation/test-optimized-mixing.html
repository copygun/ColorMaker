<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ìµœì í™”ëœ ì‰í¬ ë°°í•© í…ŒìŠ¤íŠ¸</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            text-align: center;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .test-section {
            margin: 30px 0;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background: #fafafa;
        }
        .test-title {
            font-size: 18px;
            font-weight: bold;
            color: #555;
            margin-bottom: 15px;
        }
        .result {
            background: white;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
        }
        .ink-item {
            display: inline-block;
            margin: 5px;
            padding: 8px 15px;
            background: #e3f2fd;
            border-radius: 20px;
            font-size: 14px;
        }
        .satin {
            background: #fff3e0;
        }
        .success {
            color: green;
            font-weight: bold;
        }
        .error {
            color: red;
            font-weight: bold;
        }
        .delta-e {
            display: inline-block;
            padding: 5px 10px;
            border-radius: 5px;
            margin-left: 10px;
            font-weight: bold;
        }
        .excellent { background: #4caf50; color: white; }
        .good { background: #8bc34a; color: white; }
        .fair { background: #ffc107; color: #333; }
        .poor { background: #f44336; color: white; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ¯ ìµœì í™”ëœ ì‰í¬ ë°°í•© í…ŒìŠ¤íŠ¸</h1>
        
        <div class="test-section">
            <div class="test-title">í…ŒìŠ¤íŠ¸ 1: ëª¨ë“  ë†ë„ í¬í•¨ í™•ì¸</div>
            <div id="test1-result" class="result">í…ŒìŠ¤íŠ¸ ì¤‘...</div>
        </div>
        
        <div class="test-section">
            <div class="test-title">í…ŒìŠ¤íŠ¸ 2: ìµœì  ë°°í•© ê³„ì‚° (íŒŒë€ìƒ‰ ëª©í‘œ)</div>
            <div id="test2-result" class="result">í…ŒìŠ¤íŠ¸ ì¤‘...</div>
        </div>
        
        <div class="test-section">
            <div class="test-title">í…ŒìŠ¤íŠ¸ 3: ë¹„ìš© ê°€ì¤‘ì¹˜ ì ìš© í™•ì¸</div>
            <div id="test3-result" class="result">í…ŒìŠ¤íŠ¸ ì¤‘...</div>
        </div>
        
        <div class="test-section">
            <div class="test-title">í…ŒìŠ¤íŠ¸ 4: ì„ íƒëœ ì‰í¬ vs ëª¨ë“  ì‰í¬ ë¹„êµ</div>
            <div id="test4-result" class="result">í…ŒìŠ¤íŠ¸ ì¤‘...</div>
        </div>
    </div>

    <script type="module">
        // ëª¨ë“ˆ ì„í¬íŠ¸
        import { OptimizedMixingEngine } from './core/optimizedMixingEngine.js';
        import { baseInks } from './core/inkDatabase.js';
        import { MixingEngine } from './core/mixingEngine.js';
        
        // í…ŒìŠ¤íŠ¸ 1: ëª¨ë“  ë†ë„ í¬í•¨ í™•ì¸
        function test1() {
            const engine = new OptimizedMixingEngine();
            const candidates = engine.generateInkCandidates(baseInks, [100, 70, 40], true);
            
            let html = '<div class="success">âœ… ì‰í¬ í›„ë³´ ìƒì„± ì„±ê³µ</div>';
            html += `<div>ì´ ${candidates.length}ê°œ ì‰í¬ í›„ë³´:</div>`;
            
            // ë†ë„ë³„ë¡œ ê·¸ë£¹í™”
            const by100 = candidates.filter(c => c.concentration === 100);
            const by70 = candidates.filter(c => c.concentration === 70);
            const by40 = candidates.filter(c => c.concentration === 40);
            
            html += `<div>100% ë†ë„: ${by100.length}ê°œ</div>`;
            html += '<div>';
            by100.forEach(ink => {
                html += `<span class="ink-item">${ink.name}</span>`;
            });
            html += '</div>';
            
            html += `<div>70% ë†ë„ (Satin): ${by70.length}ê°œ</div>`;
            html += '<div>';
            by70.forEach(ink => {
                html += `<span class="ink-item satin">${ink.name}</span>`;
            });
            html += '</div>';
            
            html += `<div>40% ë†ë„ (Satin): ${by40.length}ê°œ</div>`;
            html += '<div>';
            by40.forEach(ink => {
                html += `<span class="ink-item satin">${ink.name}</span>`;
            });
            html += '</div>';
            
            document.getElementById('test1-result').innerHTML = html;
        }
        
        // í…ŒìŠ¤íŠ¸ 2: ìµœì  ë°°í•© ê³„ì‚°
        function test2() {
            const engine = new OptimizedMixingEngine();
            const targetLab = { L: 30, a: 20, b: -60 }; // íŒŒë€ìƒ‰
            
            const result = engine.findOptimalMix(targetLab, baseInks, {
                maxInks: 4,
                preferredConcentrations: [100, 70, 40],
                includeWhite: true,
                costWeight: 0.2
            });
            
            const formatted = engine.formatResult(result);
            
            let html = '<div class="success">âœ… ìµœì  ë°°í•© ê³„ì‚° ì„±ê³µ</div>';
            html += `<div>ëª©í‘œ ìƒ‰ìƒ: L:${targetLab.L} a:${targetLab.a} b:${targetLab.b}</div>`;
            
            const deltaEClass = formatted.deltaE < 1 ? 'excellent' : 
                               formatted.deltaE < 2 ? 'good' : 
                               formatted.deltaE < 5 ? 'fair' : 'poor';
            
            html += `<div>í’ˆì§ˆ: ${formatted.quality} <span class="delta-e ${deltaEClass}">Î”E: ${formatted.deltaE}</span></div>`;
            html += '<div>ë°°í•© ë ˆì‹œí”¼:</div>';
            html += '<ul>';
            formatted.inks.forEach(ink => {
                const satinText = ink.isSatin ? ' (Satin)' : '';
                html += `<li>${ink.name}: ${ink.percentage}%${satinText}</li>`;
            });
            html += '</ul>';
            html += `<div>ë‹¬ì„± ìƒ‰ìƒ: L:${formatted.achievedLab.L.toFixed(1)} a:${formatted.achievedLab.a.toFixed(1)} b:${formatted.achievedLab.b.toFixed(1)}</div>`;
            html += `<div>ì˜ˆìƒ ë¹„ìš© ì§€ìˆ˜: ${formatted.cost}</div>`;
            
            document.getElementById('test2-result').innerHTML = html;
        }
        
        // í…ŒìŠ¤íŠ¸ 3: ë¹„ìš© ê°€ì¤‘ì¹˜ ì ìš©
        function test3() {
            const engine = new OptimizedMixingEngine();
            const targetLab = { L: 60, a: 30, b: 40 }; // ì˜¤ë Œì§€ìƒ‰
            
            // ë‚®ì€ ë¹„ìš© ê°€ì¤‘ì¹˜
            const lowCost = engine.findOptimalMix(targetLab, baseInks, {
                maxInks: 3,
                preferredConcentrations: [100, 70, 40],
                includeWhite: true,
                costWeight: 0.1
            });
            
            // ë†’ì€ ë¹„ìš© ê°€ì¤‘ì¹˜
            const highCost = engine.findOptimalMix(targetLab, baseInks, {
                maxInks: 3,
                preferredConcentrations: [100, 70, 40],
                includeWhite: true,
                costWeight: 0.9
            });
            
            const lowFormatted = engine.formatResult(lowCost);
            const highFormatted = engine.formatResult(highCost);
            
            let html = '<div class="success">âœ… ë¹„ìš© ê°€ì¤‘ì¹˜ í…ŒìŠ¤íŠ¸ ì„±ê³µ</div>';
            
            html += '<div><strong>ë‚®ì€ ë¹„ìš© ê°€ì¤‘ì¹˜ (0.1):</strong></div>';
            html += '<ul>';
            lowFormatted.inks.forEach(ink => {
                html += `<li>${ink.name}: ${ink.percentage}%</li>`;
            });
            html += '</ul>';
            html += `<div>ë¹„ìš©: ${lowFormatted.cost}, Î”E: ${lowFormatted.deltaE}</div>`;
            
            html += '<div><strong>ë†’ì€ ë¹„ìš© ê°€ì¤‘ì¹˜ (0.9):</strong></div>';
            html += '<ul>';
            highFormatted.inks.forEach(ink => {
                html += `<li>${ink.name}: ${ink.percentage}%</li>`;
            });
            html += '</ul>';
            html += `<div>ë¹„ìš©: ${highFormatted.cost}, Î”E: ${highFormatted.deltaE}</div>`;
            
            const costDiff = (parseFloat(highFormatted.cost) - parseFloat(lowFormatted.cost)).toFixed(2);
            html += `<div class="${costDiff < 0 ? 'success' : 'error'}">ë¹„ìš© ì°¨ì´: ${costDiff} (ë†’ì€ ê°€ì¤‘ì¹˜ì¼ ë•Œ ${costDiff < 0 ? 'ë” ì €ë ´' : 'ë” ë¹„ìŒˆ'})</div>`;
            
            document.getElementById('test3-result').innerHTML = html;
        }
        
        // í…ŒìŠ¤íŠ¸ 4: ì„ íƒëœ ì‰í¬ vs ëª¨ë“  ì‰í¬
        function test4() {
            const targetLab = { L: 45, a: -20, b: 30 }; // ë…¹ìƒ‰
            
            // ê¸°ì¡´ ë°©ì‹ (ì„ íƒëœ ì‰í¬ë§Œ)
            const oldEngine = new MixingEngine();
            const selectedInks = ['cyan', 'yellow', 'black'].map(id => {
                const ink = baseInks.find(i => i.id === id);
                return ink.concentrations[100]; // 100% ë†ë„ë§Œ
            });
            const oldResult = oldEngine.optimize(targetLab, selectedInks, { method: 'simple' });
            
            // ìƒˆ ë°©ì‹ (ëª¨ë“  ë†ë„)
            const newEngine = new OptimizedMixingEngine();
            const newResult = newEngine.findOptimalMix(targetLab, baseInks, {
                maxInks: 4,
                preferredConcentrations: [100, 70, 40],
                includeWhite: false,
                costWeight: 0.2
            });
            const newFormatted = newEngine.formatResult(newResult);
            
            let html = '<div class="success">âœ… ë¹„êµ í…ŒìŠ¤íŠ¸ ì„±ê³µ</div>';
            
            html += '<div><strong>ê¸°ì¡´ ë°©ì‹ (ì„ íƒëœ ì‰í¬, 100% ë†ë„ë§Œ):</strong></div>';
            html += '<ul>';
            html += '<li>Cyan 100%: ' + (oldResult.ratios[0] * 100).toFixed(1) + '%</li>';
            html += '<li>Yellow 100%: ' + (oldResult.ratios[1] * 100).toFixed(1) + '%</li>';
            html += '<li>Black 100%: ' + (oldResult.ratios[2] * 100).toFixed(1) + '%</li>';
            html += '</ul>';
            html += `<div>Î”E: ${oldResult.deltaE.toFixed(2)}</div>`;
            
            html += '<div><strong>ìƒˆ ë°©ì‹ (ëª¨ë“  ì‰í¬, ëª¨ë“  ë†ë„):</strong></div>';
            html += '<ul>';
            newFormatted.inks.forEach(ink => {
                const satinText = ink.isSatin ? ' (Satin)' : '';
                html += `<li>${ink.name}: ${ink.percentage}%${satinText}</li>`;
            });
            html += '</ul>';
            html += `<div>Î”E: ${newFormatted.deltaE}</div>`;
            
            const improvement = ((oldResult.deltaE - parseFloat(newFormatted.deltaE)) / oldResult.deltaE * 100).toFixed(1);
            html += `<div class="success">ê°œì„ ìœ¨: ${improvement}% (Î”E ${oldResult.deltaE.toFixed(2)} â†’ ${newFormatted.deltaE})</div>`;
            
            document.getElementById('test4-result').innerHTML = html;
        }
        
        // í…ŒìŠ¤íŠ¸ ì‹¤í–‰
        setTimeout(() => {
            try {
                test1();
                test2();
                test3();
                test4();
            } catch (error) {
                console.error('í…ŒìŠ¤íŠ¸ ì˜¤ë¥˜:', error);
            }
        }, 100);
    </script>
</body>
</html>