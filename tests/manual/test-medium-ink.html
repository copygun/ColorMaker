<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>MEDIUM ì‰í¬ íš¨ê³¼ í…ŒìŠ¤íŠ¸</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            padding: 20px;
            max-width: 1400px;
            margin: 0 auto;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
        }
        h1 {
            color: #2c3e50;
            text-align: center;
            padding: 20px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        .test-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .color-box {
            width: 100%;
            height: 100px;
            border: 2px solid #333;
            border-radius: 5px;
            margin: 10px 0;
        }
        .recipe-info {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            font-family: monospace;
            font-size: 12px;
        }
        .comparison-chart {
            width: 100%;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin: 20px 0;
        }
        table {
            width: 100%;
            border-collapse: collapse;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 10px;
            text-align: left;
        }
        th {
            background: #34495e;
            color: white;
        }
        .medium-effect {
            background: #e8f4fd;
        }
        .controls {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        input[type="range"] {
            width: 100%;
            margin: 10px 0;
        }
        .delta-e {
            font-weight: bold;
            padding: 5px 10px;
            border-radius: 5px;
            display: inline-block;
        }
        .delta-e.excellent { background: #d4f4dd; color: #27ae60; }
        .delta-e.good { background: #fff3cd; color: #f39c12; }
        .delta-e.poor { background: #ffd4d4; color: #e74c3c; }
    </style>
</head>
<body>
    <h1>ğŸ§ª MEDIUM ì‰í¬ íš¨ê³¼ í…ŒìŠ¤íŠ¸</h1>
    
    <div class="controls">
        <h3>í…ŒìŠ¤íŠ¸ ì„¤ì •</h3>
        <label>
            MEDIUM ë¹„ìœ¨: <span id="medium-value">0</span>%
            <input type="range" id="medium-ratio" min="0" max="50" value="0" step="5">
        </label>
        <button onclick="runTest()">í…ŒìŠ¤íŠ¸ ì‹¤í–‰</button>
    </div>
    
    <div class="test-grid" id="test-results"></div>
    
    <div class="comparison-chart">
        <h3>MEDIUM íš¨ê³¼ ë¶„ì„</h3>
        <div id="analysis"></div>
    </div>

    <script type="module">
        import { AdvancedMixingEngine } from './core/advancedMixingEngine.js';
        import { ColorScience } from './core/colorScience.js';
        
        // í…ŒìŠ¤íŠ¸ ìƒ‰ìƒë“¤
        const testColors = [
            { name: 'PANTONE 317C (Cyanê³„ì—´)', target: { L: 84.5, a: -18.0, b: -7.5 } },
            { name: 'PANTONE 185C (Redê³„ì—´)', target: { L: 53, a: 70, b: 48 } },
            { name: 'PANTONE 354C (Greenê³„ì—´)', target: { L: 80, a: -50, b: 40 } }
        ];
        
        // ë² ì´ìŠ¤ ì‰í¬
        const baseInks = [
            { id: 'cyan', L: 55, a: -37, b: -50, type: 'spot', name: 'Cyan' },
            { id: 'magenta', L: 48, a: 74, b: -3, type: 'spot', name: 'Magenta' },
            { id: 'yellow', L: 89, a: -5, b: 93, type: 'spot', name: 'Yellow' },
            { id: 'black', L: 16, a: 0, b: 0, type: 'spot', name: 'Black' },
            { id: 'medium', L: 96, a: 0, b: 0, type: 'medium', name: 'MEDIUM' }
        ];
        
        const slider = document.getElementById('medium-ratio');
        const valueDisplay = document.getElementById('medium-value');
        
        slider.addEventListener('input', (e) => {
            valueDisplay.textContent = e.target.value;
        });
        
        window.runTest = async function() {
            const mediumRatio = parseInt(slider.value) / 100;
            const resultsDiv = document.getElementById('test-results');
            const analysisDiv = document.getElementById('analysis');
            
            resultsDiv.innerHTML = '';
            
            const engine = new AdvancedMixingEngine({
                printMethod: 'offset',
                substrateType: 'white_coated',
                enableKubelkaMunk: true,
                enableDotGain: true,
                enableSubstrate: true
            });
            
            const results = [];
            
            for (const testCase of testColors) {
                // MEDIUM ì—†ì´ ê³„ì‚°
                const withoutMedium = await engine.optimize(
                    testCase.target,
                    baseInks.filter(ink => ink.id !== 'medium'),
                    { maxIterations: 100, tolerance: 0.5 }
                );
                
                // MEDIUM í¬í•¨ ê³„ì‚°
                let inksWithMedium = [...baseInks];
                let ratiosWithMedium;
                
                if (mediumRatio > 0) {
                    // ê¸°ì¡´ ìµœì í™” ê²°ê³¼ì—ì„œ ë¹„ìœ¨ ì¡°ì •
                    const colorInkRatio = 1 - mediumRatio;
                    ratiosWithMedium = [
                        ...withoutMedium.ratios.map(r => r * colorInkRatio),
                        mediumRatio
                    ];
                    
                    // ì¬ê³„ì‚°
                    const mixedWithMedium = engine.mixInks(inksWithMedium, ratiosWithMedium);
                    const deltaEWithMedium = ColorScience.calculateDeltaE00(
                        testCase.target.L, testCase.target.a, testCase.target.b,
                        mixedWithMedium.L, mixedWithMedium.a, mixedWithMedium.b
                    );
                    
                    results.push({
                        name: testCase.name,
                        target: testCase.target,
                        withoutMedium: withoutMedium,
                        withMedium: {
                            mixed: mixedWithMedium,
                            deltaE: deltaEWithMedium,
                            ratios: ratiosWithMedium
                        }
                    });
                } else {
                    results.push({
                        name: testCase.name,
                        target: testCase.target,
                        withoutMedium: withoutMedium,
                        withMedium: withoutMedium
                    });
                }
                
                // ê²°ê³¼ ì¹´ë“œ ìƒì„±
                createResultCard(results[results.length - 1], resultsDiv);
            }
            
            // ë¶„ì„ í…Œì´ë¸” ìƒì„±
            createAnalysisTable(results, mediumRatio, analysisDiv);
        };
        
        function createResultCard(result, container) {
            const card = document.createElement('div');
            card.className = 'test-card';
            
            const withoutRgb = ColorScience.labToRgb(
                result.withoutMedium.mixed.L,
                result.withoutMedium.mixed.a,
                result.withoutMedium.mixed.b
            );
            
            const withRgb = ColorScience.labToRgb(
                result.withMedium.mixed.L,
                result.withMedium.mixed.a,
                result.withMedium.mixed.b
            );
            
            const targetRgb = ColorScience.labToRgb(
                result.target.L,
                result.target.a,
                result.target.b
            );
            
            card.innerHTML = `
                <h3>${result.name}</h3>
                
                <div style="display: flex; gap: 10px;">
                    <div style="flex: 1;">
                        <h4>ëª©í‘œ ìƒ‰ìƒ</h4>
                        <div class="color-box" style="background-color: rgb(${targetRgb.r}, ${targetRgb.g}, ${targetRgb.b});"></div>
                        <div class="recipe-info">
                            L: ${result.target.L.toFixed(1)}<br>
                            a: ${result.target.a.toFixed(1)}<br>
                            b: ${result.target.b.toFixed(1)}
                        </div>
                    </div>
                    
                    <div style="flex: 1;">
                        <h4>MEDIUM ì—†ì´</h4>
                        <div class="color-box" style="background-color: rgb(${withoutRgb.r}, ${withoutRgb.g}, ${withoutRgb.b});"></div>
                        <div class="recipe-info">
                            L: ${result.withoutMedium.mixed.L.toFixed(1)}<br>
                            a: ${result.withoutMedium.mixed.a.toFixed(1)}<br>
                            b: ${result.withoutMedium.mixed.b.toFixed(1)}<br>
                            <span class="delta-e ${getDeltaEClass(result.withoutMedium.deltaE)}">
                                Î”E: ${result.withoutMedium.deltaE.toFixed(2)}
                            </span>
                        </div>
                    </div>
                    
                    <div style="flex: 1;">
                        <h4>MEDIUM í¬í•¨</h4>
                        <div class="color-box" style="background-color: rgb(${withRgb.r}, ${withRgb.g}, ${withRgb.b});"></div>
                        <div class="recipe-info">
                            L: ${result.withMedium.mixed.L.toFixed(1)}<br>
                            a: ${result.withMedium.mixed.a.toFixed(1)}<br>
                            b: ${result.withMedium.mixed.b.toFixed(1)}<br>
                            <span class="delta-e ${getDeltaEClass(result.withMedium.deltaE)}">
                                Î”E: ${result.withMedium.deltaE.toFixed(2)}
                            </span>
                        </div>
                    </div>
                </div>
            `;
            
            container.appendChild(card);
        }
        
        function createAnalysisTable(results, mediumRatio, container) {
            let html = `
                <table>
                    <thead>
                        <tr>
                            <th>ìƒ‰ìƒ</th>
                            <th>í•­ëª©</th>
                            <th>MEDIUM ì—†ì´</th>
                            <th>MEDIUM ${(mediumRatio * 100).toFixed(0)}%</th>
                            <th>ë³€í™”ëŸ‰</th>
                        </tr>
                    </thead>
                    <tbody>
            `;
            
            for (const result of results) {
                const deltaL = result.withMedium.mixed.L - result.withoutMedium.mixed.L;
                const deltaA = result.withMedium.mixed.a - result.withoutMedium.mixed.a;
                const deltaB = result.withMedium.mixed.b - result.withoutMedium.mixed.b;
                const deltaDeltaE = result.withMedium.deltaE - result.withoutMedium.deltaE;
                
                html += `
                    <tr>
                        <td rowspan="5">${result.name}</td>
                        <td>L (ëª…ë„)</td>
                        <td>${result.withoutMedium.mixed.L.toFixed(1)}</td>
                        <td class="medium-effect">${result.withMedium.mixed.L.toFixed(1)}</td>
                        <td>${deltaL > 0 ? '+' : ''}${deltaL.toFixed(1)}</td>
                    </tr>
                    <tr>
                        <td>a (Red-Green)</td>
                        <td>${result.withoutMedium.mixed.a.toFixed(1)}</td>
                        <td class="medium-effect">${result.withMedium.mixed.a.toFixed(1)}</td>
                        <td>${deltaA > 0 ? '+' : ''}${deltaA.toFixed(1)}</td>
                    </tr>
                    <tr>
                        <td>b (Blue-Yellow)</td>
                        <td>${result.withoutMedium.mixed.b.toFixed(1)}</td>
                        <td class="medium-effect">${result.withMedium.mixed.b.toFixed(1)}</td>
                        <td>${deltaB > 0 ? '+' : ''}${deltaB.toFixed(1)}</td>
                    </tr>
                    <tr>
                        <td>ì±„ë„</td>
                        <td>${Math.sqrt(result.withoutMedium.mixed.a**2 + result.withoutMedium.mixed.b**2).toFixed(1)}</td>
                        <td class="medium-effect">${Math.sqrt(result.withMedium.mixed.a**2 + result.withMedium.mixed.b**2).toFixed(1)}</td>
                        <td>-${(Math.sqrt(result.withoutMedium.mixed.a**2 + result.withoutMedium.mixed.b**2) - Math.sqrt(result.withMedium.mixed.a**2 + result.withMedium.mixed.b**2)).toFixed(1)}</td>
                    </tr>
                    <tr>
                        <td>Î”E</td>
                        <td>${result.withoutMedium.deltaE.toFixed(2)}</td>
                        <td class="medium-effect">${result.withMedium.deltaE.toFixed(2)}</td>
                        <td>${deltaDeltaE > 0 ? '+' : ''}${deltaDeltaE.toFixed(2)}</td>
                    </tr>
                `;
            }
            
            html += `
                    </tbody>
                </table>
                
                <div style="margin-top: 20px; padding: 15px; background: #f8f9fa; border-radius: 5px;">
                    <h4>ğŸ“Š MEDIUM ${(mediumRatio * 100).toFixed(0)}% íš¨ê³¼ ìš”ì•½</h4>
                    <ul>
                        <li><strong>ëª…ë„ ë³€í™”:</strong> í‰ê·  +${(results.reduce((sum, r) => sum + (r.withMedium.mixed.L - r.withoutMedium.mixed.L), 0) / results.length).toFixed(1)} (ë°ì•„ì§)</li>
                        <li><strong>ì±„ë„ ë³€í™”:</strong> í‰ê·  -${(results.reduce((sum, r) => {
                            const satWithout = Math.sqrt(r.withoutMedium.mixed.a**2 + r.withoutMedium.mixed.b**2);
                            const satWith = Math.sqrt(r.withMedium.mixed.a**2 + r.withMedium.mixed.b**2);
                            return sum + (satWithout - satWith);
                        }, 0) / results.length).toFixed(1)} (ì±„ë„ ê°ì†Œ)</li>
                        <li><strong>ìƒ‰ì°¨ ë³€í™”:</strong> í‰ê·  ${(results.reduce((sum, r) => sum + (r.withMedium.deltaE - r.withoutMedium.deltaE), 0) / results.length).toFixed(2)} (ì •í™•ë„ ${results.reduce((sum, r) => sum + (r.withMedium.deltaE - r.withoutMedium.deltaE), 0) / results.length > 0 ? 'ê°ì†Œ' : 'ì¦ê°€'})</li>
                    </ul>
                    
                    <h4>ğŸ’¡ MEDIUM ì‚¬ìš© ê°€ì´ë“œ</h4>
                    <ul>
                        <li><strong>5-10%:</strong> ë¯¸ì„¸í•œ ìƒ‰ìƒ ì¡°ì •, ê´‘íƒ ê°œì„ </li>
                        <li><strong>10-20%:</strong> ì¤‘ê°„ ì •ë„ì˜ í¬ì„, íˆ¬ëª…ë„ ì¦ê°€</li>
                        <li><strong>20-30%:</strong> ê°•í•œ í¬ì„ íš¨ê³¼, íŒŒìŠ¤í…”í†¤ ìƒì„±</li>
                        <li><strong>30% ì´ìƒ:</strong> ë§¤ìš° ì—°í•œ ìƒ‰ìƒ, ë†’ì€ íˆ¬ëª…ë„</li>
                    </ul>
                </div>
            `;
            
            container.innerHTML = html;
        }
        
        function getDeltaEClass(deltaE) {
            if (deltaE < 1.5) return 'excellent';
            if (deltaE < 3) return 'good';
            return 'poor';
        }
        
        // ì´ˆê¸° ì‹¤í–‰
        window.addEventListener('load', () => {
            runTest();
        });
    </script>
</body>
</html>