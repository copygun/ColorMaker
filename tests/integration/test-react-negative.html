<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>React ìŒìˆ˜ ì…ë ¥ ë””ë²„ê¹…</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 50px;
            background: #f0f0f0;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            margin-bottom: 30px;
        }
        .test-section {
            margin: 30px 0;
            padding: 20px;
            background: #f9f9f9;
            border-radius: 5px;
            border: 2px solid #ddd;
        }
        .test-section.working {
            border-color: #4CAF50;
            background: #e8f5e9;
        }
        .test-section h3 {
            margin-top: 0;
            color: #555;
        }
        .input-group {
            margin: 15px 0;
            display: flex;
            align-items: center;
            gap: 15px;
        }
        label {
            width: 80px;
            font-weight: bold;
        }
        input {
            padding: 10px;
            font-size: 16px;
            border: 2px solid #ddd;
            border-radius: 5px;
            width: 200px;
        }
        input:focus {
            outline: none;
            border-color: #4CAF50;
        }
        .output {
            margin-top: 15px;
            padding: 15px;
            background: white;
            border-radius: 5px;
            font-family: monospace;
            font-size: 14px;
        }
        .log {
            margin-top: 20px;
            padding: 15px;
            background: #333;
            color: #0f0;
            font-family: monospace;
            font-size: 12px;
            border-radius: 5px;
            max-height: 300px;
            overflow-y: auto;
        }
        .instructions {
            background: #fff3e0;
            padding: 20px;
            border-radius: 5px;
            margin-bottom: 30px;
            border-left: 4px solid #ff9800;
        }
        .success {
            color: #4CAF50;
            font-weight: bold;
        }
        .fail {
            color: #f44336;
            font-weight: bold;
        }
        button {
            padding: 10px 20px;
            margin: 5px;
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
        }
        button:hover {
            background: #45a049;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”¬ React ìŒìˆ˜ ì…ë ¥ ë¬¸ì œ ì¬í˜„ í…ŒìŠ¤íŠ¸</h1>
        
        <div class="instructions">
            <h3>ğŸ¯ í…ŒìŠ¤íŠ¸ ëª©í‘œ</h3>
            <p>ColorInput.tsxì™€ ë™ì¼í•œ ë°©ì‹ìœ¼ë¡œ ìŒìˆ˜ ì…ë ¥ ë¬¸ì œë¥¼ ì¬í˜„í•˜ê³  í•´ê²°í•©ë‹ˆë‹¤.</p>
            <ul>
                <li><strong>ëª©í‘œ:</strong> '-50'ì„ ì…ë ¥í•  ë•Œ '-' ë¬¸ìê°€ '0'ìœ¼ë¡œ ë³€í•˜ì§€ ì•Šì•„ì•¼ í•¨</li>
                <li><strong>ë°©ë²•:</strong> '-' í‚¤ë¥¼ ëˆ„ë¥´ê³ , '5', '0'ì„ ìˆœì„œëŒ€ë¡œ ì…ë ¥</li>
                <li><strong>ì„±ê³µ ê¸°ì¤€:</strong> ì…ë ¥ í•„ë“œì— "-50"ì´ í‘œì‹œë˜ê³  ìœ ì§€ë¨</li>
            </ul>
        </div>

        <div id="root"></div>

        <div class="log" id="globalLog">
            í…ŒìŠ¤íŠ¸ ì¤€ë¹„ ì¤‘...<br>
        </div>
    </div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // ì „ì—­ ë¡œê·¸ í•¨ìˆ˜
        function addGlobalLog(message) {
            const log = document.getElementById('globalLog');
            const time = new Date().toLocaleTimeString();
            log.innerHTML += `[${time}] ${message}<br>`;
            log.scrollTop = log.scrollHeight;
        }

        // ë¬¸ì œê°€ ìˆëŠ” ColorInput ì¬í˜„
        function ProblematicColorInput({ value, onChange }) {
            const [localValue, setLocalValue] = useState(value);
            const [inputValues, setInputValues] = useState({
                L: value.L.toString(),
                a: value.a.toString(),
                b: value.b.toString()
            });

            // ë¬¸ì œì˜ useEffect - onChange í˜¸ì¶œ ì‹œ ì…ë ¥ê°’ì´ ë®ì–´ì¨ì§
            useEffect(() => {
                setLocalValue(value);
                setInputValues({
                    L: value.L.toString(),
                    a: value.a.toString(),
                    b: value.b.toString()
                });
            }, [value]);

            const handleInputChange = (component, newValue) => {
                addGlobalLog(`[ë¬¸ì œ] ${component} ì…ë ¥: "${newValue}"`);
                
                setInputValues(prev => ({
                    ...prev,
                    [component]: newValue
                }));

                // ì‹¤ì‹œê°„ìœ¼ë¡œ onChange í˜¸ì¶œ (ë¬¸ì œì˜ ì›ì¸)
                if (newValue !== '-' && newValue !== '') {
                    const num = parseFloat(newValue);
                    if (!isNaN(num)) {
                        const updated = { ...localValue, [component]: num };
                        setLocalValue(updated);
                        onChange(updated); // ì´ê²ƒì´ useEffectë¥¼ íŠ¸ë¦¬ê±°í•¨!
                    }
                }
            };

            return (
                <div className="test-section">
                    <h3>âŒ ë¬¸ì œ ìˆëŠ” êµ¬í˜„ (onChange ì‹¤ì‹œê°„ í˜¸ì¶œ)</h3>
                    <div className="input-group">
                        <label>a*:</label>
                        <input
                            type="text"
                            value={inputValues.a}
                            onChange={(e) => handleInputChange('a', e.target.value)}
                            placeholder="-20 ì…ë ¥"
                        />
                    </div>
                    <div className="output">
                        ì…ë ¥ê°’: "{inputValues.a}" | ì‹¤ì œê°’: {localValue.a}
                    </div>
                </div>
            );
        }

        // ìˆ˜ì •ëœ ColorInput
        function FixedColorInput({ value, onChange }) {
            const [localValue, setLocalValue] = useState(value);
            const [inputValues, setInputValues] = useState({
                L: value.L.toString(),
                a: value.a.toString(),
                b: value.b.toString()
            });
            const inputRefs = useRef({});

            // í¬ì»¤ìŠ¤ ì²´í¬í•˜ì—¬ ì‚¬ìš©ì ì…ë ¥ ì¤‘ì—ëŠ” ì—…ë°ì´íŠ¸ ë°©ì§€
            useEffect(() => {
                const activeElement = document.activeElement;
                const isInputFocused = activeElement && 
                    Object.values(inputRefs.current).includes(activeElement);
                
                if (!isInputFocused) {
                    setLocalValue(value);
                    setInputValues({
                        L: value.L.toString(),
                        a: value.a.toString(),
                        b: value.b.toString()
                    });
                }
            }, [value]);

            const handleInputChange = (component, newValue) => {
                addGlobalLog(`[ìˆ˜ì •ë¨] ${component} ì…ë ¥: "${newValue}"`);
                
                // ì…ë ¥ê°’ë§Œ ì—…ë°ì´íŠ¸, onChangeëŠ” í˜¸ì¶œí•˜ì§€ ì•ŠìŒ
                setInputValues(prev => ({
                    ...prev,
                    [component]: newValue
                }));
            };

            const handleInputBlur = (component) => {
                const inputValue = inputValues[component];
                addGlobalLog(`[ìˆ˜ì •ë¨] ${component} blur: "${inputValue}"`);
                
                if (inputValue === '' || inputValue === '-' || inputValue === '.') {
                    setInputValues(prev => ({
                        ...prev,
                        [component]: localValue[component].toString()
                    }));
                    return;
                }

                const num = parseFloat(inputValue);
                if (!isNaN(num)) {
                    const updated = { ...localValue, [component]: num };
                    setLocalValue(updated);
                    onChange(updated);
                }
            };

            return (
                <div className="test-section working">
                    <h3>âœ… ìˆ˜ì •ëœ êµ¬í˜„ (blurì—ì„œë§Œ onChange í˜¸ì¶œ)</h3>
                    <div className="input-group">
                        <label>a*:</label>
                        <input
                            ref={el => inputRefs.current.a = el}
                            type="text"
                            value={inputValues.a}
                            onChange={(e) => handleInputChange('a', e.target.value)}
                            onBlur={() => handleInputBlur('a')}
                            placeholder="-20 ì…ë ¥"
                        />
                    </div>
                    <div className="output">
                        ì…ë ¥ê°’: <span className="success">"{inputValues.a}"</span> | ì‹¤ì œê°’: {localValue.a}
                    </div>
                </div>
            );
        }

        // ë©”ì¸ ì•±
        function App() {
            const [color1, setColor1] = useState({ L: 50, a: 0, b: 0 });
            const [color2, setColor2] = useState({ L: 50, a: 0, b: 0 });

            return (
                <>
                    <ProblematicColorInput value={color1} onChange={setColor1} />
                    <FixedColorInput value={color2} onChange={setColor2} />
                    
                    <div style={{ marginTop: '30px', textAlign: 'center' }}>
                        <button onClick={() => {
                            setColor1({ L: 50, a: -30, b: 20 });
                            setColor2({ L: 50, a: -30, b: 20 });
                            addGlobalLog('í”„ë¡œê·¸ë˜ë°ì ìœ¼ë¡œ ê°’ ì„¤ì •: a* = -30');
                        }}>
                            í”„ë¡œê·¸ë˜ë°ì ìœ¼ë¡œ -30 ì„¤ì •
                        </button>
                        <button onClick={() => {
                            setColor1({ L: 50, a: 0, b: 0 });
                            setColor2({ L: 50, a: 0, b: 0 });
                            addGlobalLog('ê°’ ì´ˆê¸°í™”');
                        }}>
                            ì´ˆê¸°í™”
                        </button>
                    </div>
                </>
            );
        }

        // React ë Œë”ë§
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);

        addGlobalLog('React ì»´í¬ë„ŒíŠ¸ ë Œë”ë§ ì™„ë£Œ');
        addGlobalLog('ìœ„ìª½(ë¹¨ê°„ í…Œë‘ë¦¬): ë¬¸ì œ ìˆëŠ” êµ¬í˜„ - "-" ì…ë ¥ ì‹œ ì‚¬ë¼ì§');
        addGlobalLog('ì•„ë˜ìª½(ë…¹ìƒ‰ í…Œë‘ë¦¬): ìˆ˜ì •ëœ êµ¬í˜„ - "-" ì…ë ¥ ê°€ëŠ¥');
    </script>
</body>
</html>